<style type="text/css">
    #mynetwork {
        width: 100%;
        height: 80vh;
        border: 1px solid lightgray;
    }
</style>

<h2><img src="{{ serverimg(server.id, server.icon) }}" class="rounded small"/>{{ server.name }}</h2>
<div class="container">
  <div class="row">
    <div class="col">
      <h2>Current informations</h2>
      <p><b>{{ serverinfos.nbmessages }}</b> messages</p>
      <p><b>{{ serverinfos.nbchannels }}</b> channels</p>
      <p>From <b>{{ serverinfos.firstmessage.timestamp }}</b> to <b>{{ serverinfos.lastmessage.timestamp }}</b></p>
    </div>
    <div class="col">
      <h2>Compute more stats</h2>
      <form class="form-inline">
        <label class="mr-sm-2" for="channelSelect">Channel</label>
        <select class="custom-select mb-2 mr-sm-2 mb-sm-0" id="channelSelect">
          <option value="0">General</option>
          <option value="1">One</option>
          <option value="2">Two</option>
        </select>
        <label class="sr-only" for="nbMessagesInpute">Nb messages</label>
        <input type="number" class="form-control mb-2 mr-sm-2 mb-sm-0" id="nbMessagesInpute" placeholder="100">
        <button type="submit" class="btn btn-primary">Compute</button>
      </form>
    </div>
</div>

<!-- COMPUTE BUTTON LOGIC -->
<script>
  var computeButton = document.getElementById("computeButton");
  var nbMessagesInput = document.getElementById("nbMessages");
  var channelSelect = document.getElementById("channelSelect");

  computeButton.on('click', function () {

      var guildId = '{{ data.guildId }}';
      var channelId = 0; // Select value

      fetch('/api/compute/' + guildId + "?channelId=" + channelId)
          .then(function(response) {
              return response.json();
          })
          .then(function(json) {
              nodes = json['data'];
          });
  });
</script>

<h3>Stats</h3>

<hr class="my-4">

<!-- GRAPH -->

<h3>Graph</h3>

<div id="mynetwork"></div>

<script>
    var channelId = '{{ data.guildId }}';
    var nodesJson;
    var edgesJson;
    var nodes;
    var edges;
    fetch('/api/graph/' + channelId)
        .then(function (response) {
            return response.json();
        })
        .then(function (json) {
            nodesJson = json['nodes'];
            edgesJson = json['edges'];

            //--> code here
            nodes = new vis.DataSet(nodesJson);
            edges = new vis.DataSet(edgesJson);

            // Instantiate our network object.
            var container = document.getElementById('mynetwork');
            var data = {
                nodes: nodes,
                edges: edges
            };
            var options = {
                "edges": {
                    "smooth": {
                        "forceDirection": "none"
                    }
                },
                nodes: {
                    shape: 'dot',
                    scaling: {
                        label: {
                            min: 18,
                            max: 30
                        },
                        customScalingFunction: function (min, max, total, value) {
                            return value / total;
                        },
                        min: 5,
                        max: 150
                    }
                },
                "physics": {
                    "barnesHut": {
                        "avoidOverlap": 0.5,
                        //"centralGravity": 1,
                        "springLength": 700
                    },
                    "minVelocity": 0.75
                }
            };
            network = new vis.Network(container, data, options);
        });

    // create an array with nodes
    /*
     var nodes = new vis.DataSet([
     {id: 1, label: 'Node 1', color:'#97C2FC', value : 2},
     {id: 2, label: 'Node 2', color:'#FFFF00', value : 8},
     {id: 3, label: 'Node 3', color:'#FB7E81', value : 17},
     {id: 4, label: 'Node 4', color:'#7BE141', value : 1},
     {id: 5, label: 'Node 5', color:'#FFA807', value : 14}
     ]);*/

    // create an array with edges
    /*new vis.DataSet([
     {from: 1, to: 3, value: 3},
     {from: 1, to: 2, value: 5},
     {from: 2, to: 4, value: 7},
     {from: 2, to: 5, value: 2},
     {from: 3, to: 3, value: 1}
     ]);*/

</script>


